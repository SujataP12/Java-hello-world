pipeline {
    agent any
    environment {
        DOCKER_IMAGE = "sujatap12/testimg"
        DOCKER_TAG = "latest"
    }
    stages {
        stage('Java Hello World') {
            steps {
                script {
                    echo 'Hello world!'
                    //checkout([$class: 'GitSCM', branches: [[name: 'main']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'github_cred', url: 'https://github.com/SujataP12/Java-hello-world.git']]])
                    sh """
                    ls -l
                    cat Dockerfile
                    docker ps 
                    """
                }
            }
        }
        stage('Maven Build') {
            steps {
                echo 'This is the second stage'
                sh """
                mvn clean package
                docker build -t testimg .
                """
            }
        }
        stage('Pushing to Docker Hub') {
            steps {
                echo "This is the third stage"
                script {
                    withCredentials([usernamePassword(credentialsId: 'dockerhubcred', usernameVariable: 'sujatap12', passwordVariable: 'Alpha@1998')]) {
                        sh "echo ${passwordVariable} | docker login -u ${usernameVariable} --password-stdin"
                        sh "docker tag testimg sujatap12/testimg:latest"
                        sh "docker push sujatap12/testimg:latest"
                        sh "docker logout"
                    }
                }
            }
        }
    }
}